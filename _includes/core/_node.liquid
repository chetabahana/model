{%- assign stage = stages[layer]                 -%}
{%- assign title = titles[layer]                 -%}
{%- assign baseurl = title | prepend: "/"        -%}

{%- assign node = '<li data-type="main"'
        | append: ' class="toc level-1"'
		| append: ' data-level="1" aria-level="'
		| append: layer
        | append: '"><a href="'
        | append: baseurl
        | append: '" id="'
        | append: title
        | append: '" title="'
        | append: stage
        | append: '" class="'
        | append: 'd-flex flex-items-baseline">'
        | append: title
        | append: '</a>'                         -%}
  
{%- assign group = group | plus: 1               -%}
{%- assign group_title = 'group'                 -%}
{%- assign _node = '<li data-type="group"'
        | append: ' class="toc level-2"'
		| append: ' data-level="2" aria-level="'
		| append: layer
		| append: '"><a href="/grammar/'
		| append: group
		| append: '" id="'
		| append: group_title
		| append: '-'
		| append: group
		| append: '" title="'
		| append: group_title
		| append: '-'
		| append: group
        | append: '" class="'
        | append: 'd-flex flex-items-baseline">'
		| append: group_title
		| append: '-'
		| append: group
		| append: '</a>'                         -%}

{%- if node_type == "main"                       -%}

{%-   capture nodes                              -%}
{{-     nodes                                    -}}
{%-     include tabs.liquid size=13 -%}</ul>
{%-     include tabs.liquid size=12 -%}</li>
{%-     include tabs.liquid size=11 -%}</ul>
{%-     include tabs.liquid size=10 -%}</li>
{%-     include tabs.liquid size=10 -%}{{- node  -}}
{%-     include tabs.liquid size=11 -%}<ul>
{%-     include tabs.liquid size=12 -%}{{- _node -}}
{%-     include tabs.liquid size=13 -%}<ul>
{%-   endcapture                                 -%}

{%-   else                                       -%}

{%-   capture nodes                              -%}
{{-     nodes                                    -}}
{%-     include tabs.liquid size=13 -%}</ul>
{%-     include tabs.liquid size=12 -%}</li>
{%-     include tabs.liquid size=12 -%}{{- _node -}}
{%-     include tabs.liquid size=13 -%}<ul>
{%-   endcapture                                 -%}

{%- endif                                        -%}